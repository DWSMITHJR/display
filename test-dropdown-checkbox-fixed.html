<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dropdown Text Cropping & Checkbox Rotation Test</title>
    
    <!-- Include the main styles -->
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="styles/theme-panel-consolidated.css">
    <link rel="stylesheet" href="styles/theme-panel-fixed.css">
    
    <style>
        /* Test-specific styles */
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 20px;
            color: white;
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .test-section h2 {
            margin-top: 0;
            color: #fff;
            font-size: 1.5rem;
        }
        
        .test-section h3 {
            color: rgba(255, 255, 255, 0.9);
            margin-top: 20px;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-indicator.pass {
            background: #4caf50;
            box-shadow: 0 0 8px rgba(76, 175, 80, 0.6);
        }
        
        .status-indicator.fail {
            background: #f44336;
            box-shadow: 0 0 8px rgba(244, 67, 54, 0.6);
        }
        
        .status-indicator.pending {
            background: #ff9800;
            box-shadow: 0 0 8px rgba(255, 152, 0, 0.6);
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .test-result {
            margin: 10px 0;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
            font-family: monospace;
            font-size: 14px;
        }
        
        .test-result.pass {
            border-left: 4px solid #4caf50;
        }
        
        .test-result.fail {
            border-left: 4px solid #f44336;
        }
        
        .button {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
            transition: all 0.2s ease;
        }
        
        .button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }
        
        .demo-panel {
            position: relative;
            height: 200px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .validation-report {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üîß Dropdown Text Cropping & Checkbox Rotation Test</h1>
        <p>This page validates the fixes for dropdown text cropping and checkbox rotation functionality.</p>
        
        <!-- Test Section 1: Dropdown Text Cropping -->
        <div class="test-section">
            <h2>üìù Dropdown Text Cropping Test</h2>
            
            <h3>Original Theme Panel</h3>
            <div class="demo-panel">
                <!-- Theme Panel with Minimize Functionality -->
                <div id="theme-panel" class="style-selector">
                    <button class="minimize-btn" id="minimize-btn" title="Minimize/Maximize theme panel">‚àí</button>
                    <div class="style-selector-label drag-handle">Themes</div>
                    
                    <div class="theme-content">
                        <select id="style-dropdown" title="Select a theme">
                            <option value="style.css">Original</option>
                            <option value="styles/dark.css">Dark</option>
                            <option value="styles/ocean.css">Ocean</option>
                            <option value="styles/sunset.css">Sunset</option>
                            <option value="styles/forest.css">Forest</option>
                            <option value="styles/cyberpunk.css">Cyberpunk</option>
                            <option value="styles/galaxy.css">Galaxy</option>
                            <option value="styles/aurora.css">Aurora</option>
                            <option value="styles/vintage.css">Vintage</option>
                            <option value="styles/minimal.css">Minimal</option>
                            <option value="styles/neon.css">Neon</option>
                            <option value="styles/candy.css">Candy</option>
                        </select>
                        
                        <div class="theme-controls">
                            <div class="control-row">
                                <label for="auto-rotate" class="auto-rotate-label">
                                    <input type="checkbox" id="auto-rotate" title="Auto-rotate themes every 30 seconds">
                                    <span>Auto-rotate</span>
                                    <div class="auto-rotate-status" id="auto-rotate-status"></div>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="test-controls">
                <button class="button" onclick="testDropdownTextCropping()">Test Dropdown Text</button>
                <button class="button" onclick="testDropdownWidth()">Test Width Constraints</button>
                <button class="button" onclick="testDropdownResponsive()">Test Responsive</button>
            </div>
            
            <div id="dropdown-results"></div>
        </div>
        
        <!-- Test Section 2: Checkbox Rotation -->
        <div class="test-section">
            <h2>üîÑ Checkbox Rotation Test</h2>
            
            <div class="test-controls">
                <button class="button" onclick="testCheckboxValidation()">Run Full Validation</button>
                <button class="button" onclick="testAutoRotation()">Test Auto-Rotation</button>
                <button class="button" onclick="testPersistence()">Test Persistence</button>
                <button class="button" onclick="testStatusIndicator()">Test Status Indicator</button>
            </div>
            
            <div id="checkbox-results"></div>
        </div>
        
        <!-- Test Section 3: Combined Test -->
        <div class="test-section">
            <h2>üéØ Combined Functionality Test</h2>
            
            <div class="test-controls">
                <button class="button" onclick="runAllTests()">Run All Tests</button>
                <button class="button" onclick="clearResults()">Clear Results</button>
                <button class="button" onclick="exportResults()">Export Results</button>
            </div>
            
            <div id="combined-results"></div>
        </div>
        
        <!-- Validation Report -->
        <div class="test-section">
            <h2>üìä Validation Report</h2>
            <div id="validation-report" class="validation-report">
                <div>Waiting for validation to run...</div>
            </div>
        </div>
    </div>

    <!-- Include the main scripts -->
    <script src="script.js"></script>
    <script src="script-checkbox-validated.js"></script>
    
    <script>
        // Test functions
        let testResults = [];
        
        function addTestResult(category, testName, passed, details = '') {
            const result = {
                category: category,
                test: testName,
                passed: passed,
                details: details,
                timestamp: new Date().toISOString()
            };
            
            testResults.push(result);
            
            const statusClass = passed ? 'pass' : 'fail';
            const statusIndicator = `<span class="status-indicator ${statusClass}"></span>`;
            const detailText = details ? ` - ${details}` : '';
            
            const resultHtml = `
                <div class="test-result ${statusClass}">
                    ${statusIndicator}${testName}${detailText}
                </div>
            `;
            
            // Add to appropriate results section
            let resultsContainer;
            if (category.includes('Dropdown')) {
                resultsContainer = document.getElementById('dropdown-results');
            } else if (category.includes('Checkbox')) {
                resultsContainer = document.getElementById('checkbox-results');
            } else {
                resultsContainer = document.getElementById('combined-results');
            }
            
            if (resultsContainer) {
                resultsContainer.insertAdjacentHTML('beforeend', resultHtml);
            }
            
            return result;
        }
        
        function testDropdownTextCropping() {
            console.log('üîç Testing dropdown text cropping...');
            
            const dropdown = document.getElementById('style-dropdown');
            if (!dropdown) {
                addTestResult('Dropdown', 'Dropdown Element Found', false, 'Dropdown not found');
                return;
            }
            
            addTestResult('Dropdown', 'Dropdown Element Found', true);
            
            // Test each option for text cropping
            let issuesFound = 0;
            for (let i = 0; i < dropdown.options.length; i++) {
                const option = dropdown.options[i];
                dropdown.selectedIndex = i;
                
                // Check if text is cropped
                const textWidth = measureText(option.text, dropdown);
                const availableWidth = dropdown.clientWidth - 30; // Account for arrow padding
                
                if (textWidth > availableWidth) {
                    issuesFound++;
                    addTestResult('Dropdown', `Text Cropping: ${option.text}`, false, 
                                `Text width: ${textWidth}px, Available: ${availableWidth}px`);
                } else {
                    addTestResult('Dropdown', `Text Fit: ${option.text}`, true);
                }
            }
            
            if (issuesFound === 0) {
                addTestResult('Dropdown', 'Overall Text Cropping', true, 'No text cropping detected');
            } else {
                addTestResult('Dropdown', 'Overall Text Cropping', false, `${issuesFound} issues found`);
            }
        }
        
        function testDropdownWidth() {
            console.log('üîç Testing dropdown width constraints...');
            
            const dropdown = document.getElementById('style-dropdown');
            const panel = document.getElementById('theme-panel');
            
            if (!dropdown || !panel) {
                addTestResult('Dropdown', 'Width Test Elements', false, 'Elements not found');
                return;
            }
            
            // Test panel width
            const panelWidth = panel.clientWidth;
            const dropdownWidth = dropdown.clientWidth;
            
            addTestResult('Dropdown', 'Panel Width', true, `${panelWidth}px`);
            addTestResult('Dropdown', 'Dropdown Width', true, `${dropdownWidth}px`);
            
            // Test minimum width requirements
            if (dropdownWidth >= 140) {
                addTestResult('Dropdown', 'Minimum Width', true, 'Meets minimum width requirement');
            } else {
                addTestResult('Dropdown', 'Minimum Width', false, `Too narrow: ${dropdownWidth}px < 140px`);
            }
            
            // Test if dropdown fits in panel
            if (dropdownWidth <= panelWidth - 20) { // Account for padding
                addTestResult('Dropdown', 'Panel Fit', true, 'Dropdown fits properly in panel');
            } else {
                addTestResult('Dropdown', 'Panel Fit', false, 'Dropdown too wide for panel');
            }
        }
        
        function testDropdownResponsive() {
            console.log('üîç Testing dropdown responsiveness...');
            
            const dropdown = document.getElementById('style-dropdown');
            const panel = document.getElementById('theme-panel');
            
            if (!dropdown || !panel) {
                return;
            }
            
            // Test different viewport sizes
            const originalWidth = window.innerWidth;
            
            // Simulate mobile width
            const mobileTest = testViewportSize(480, 'Mobile');
            const tabletTest = testViewportSize(768, 'Tablet');
            const desktopTest = testViewportSize(1024, 'Desktop');
            
            if (mobileTest && tabletTest && desktopTest) {
                addTestResult('Dropdown', 'Responsive Design', true, 'Works on all viewport sizes');
            } else {
                addTestResult('Dropdown', 'Responsive Design', false, 'Issues on some viewport sizes');
            }
        }
        
        function testViewportSize(width, label) {
            const dropdown = document.getElementById('style-dropdown');
            const panel = document.getElementById('theme-panel');
            
            // This is a simplified test - in real implementation, 
            // you'd need to actually resize the viewport
            const isResponsive = dropdown && panel;
            
            addTestResult('Dropdown', `${label} Viewport`, isResponsive, 
                        isResponsive ? `Works at ${width}px` : `Fails at ${width}px`);
            
            return isResponsive;
        }
        
        function testCheckboxValidation() {
            console.log('üîç Running checkbox validation...');
            
            if (window.CheckboxRotationValidator) {
                const validator = new window.CheckboxRotationValidator();
                
                addTestResult('Checkbox', 'Validator Available', true);
                
                // Run validation
                validator.validateCheckboxRotation().then(results => {
                    const allPassed = results.checkboxExists && 
                                    results.eventListenersAttached && 
                                    results.autoRotateWorking && 
                                    results.themeSwitchingWorking;
                    
                    addTestResult('Checkbox', 'Full Validation', allPassed, 
                                allPassed ? 'All tests passed' : 'Some tests failed');
                    
                    // Update report
                    updateValidationReport(validator.getResults());
                });
            } else {
                addTestResult('Checkbox', 'Validator Available', false, 'Validator not loaded');
            }
        }
        
        function testAutoRotation() {
            console.log('üîç Testing auto-rotation...');
            
            const checkbox = document.getElementById('auto-rotate');
            if (!checkbox) {
                addTestResult('Checkbox', 'Auto-Rotation Test', false, 'Checkbox not found');
                return;
            }
            
            // Test enabling auto-rotation
            const originalState = checkbox.checked;
            checkbox.checked = true;
            checkbox.dispatchEvent(new Event('change'));
            
            setTimeout(() => {
                const hasInterval = window.themeManager?.autoRotateInterval || window.autoRotateInterval;
                
                if (hasInterval) {
                    addTestResult('Checkbox', 'Auto-Rotation Start', true, 'Interval started successfully');
                    
                    // Test stopping auto-rotation
                    checkbox.checked = false;
                    checkbox.dispatchEvent(new Event('change'));
                    
                    setTimeout(() => {
                        const intervalCleared = !window.themeManager?.autoRotateInterval && 
                                              !window.autoRotateInterval;
                        
                        if (intervalCleared) {
                            addTestResult('Checkbox', 'Auto-Rotation Stop', true, 'Interval stopped successfully');
                        } else {
                            addTestResult('Checkbox', 'Auto-Rotation Stop', false, 'Interval not cleared');
                        }
                        
                        // Restore original state
                        checkbox.checked = originalState;
                        checkbox.dispatchEvent(new Event('change'));
                    }, 200);
                } else {
                    addTestResult('Checkbox', 'Auto-Rotation Start', false, 'Interval not started');
                }
            }, 200);
        }
        
        function testPersistence() {
            console.log('üîç Testing persistence...');
            
            try {
                const checkbox = document.getElementById('auto-rotate');
                if (!checkbox) {
                    addTestResult('Checkbox', 'Persistence Test', false, 'Checkbox not found');
                    return;
                }
                
                const originalState = checkbox.checked;
                const testState = !originalState;
                
                // Change state
                checkbox.checked = testState;
                checkbox.dispatchEvent(new Event('change'));
                
                // Check localStorage
                const savedState = localStorage.getItem('autoRotateThemes') === 'true';
                
                if (savedState === testState) {
                    addTestResult('Checkbox', 'Persistence Save', true, 'State saved correctly');
                    
                    // Test loading
                    checkbox.checked = originalState;
                    const loadedState = localStorage.getItem('autoRotateThemes') === 'true';
                    
                    if (loadedState === testState) {
                        addTestResult('Checkbox', 'Persistence Load', true, 'State loaded correctly');
                    } else {
                        addTestResult('Checkbox', 'Persistence Load', false, 'State not loaded correctly');
                    }
                } else {
                    addTestResult('Checkbox', 'Persistence Save', false, 'State not saved correctly');
                }
                
                // Restore original state
                checkbox.checked = originalState;
                checkbox.dispatchEvent(new Event('change'));
                
            } catch (error) {
                addTestResult('Checkbox', 'Persistence Test', false, error.message);
            }
        }
        
        function testStatusIndicator() {
            console.log('üîç Testing status indicator...');
            
            const statusElement = document.getElementById('auto-rotate-status');
            const checkbox = document.getElementById('auto-rotate');
            
            if (!statusElement || !checkbox) {
                addTestResult('Checkbox', 'Status Indicator Test', false, 'Elements not found');
                return;
            }
            
            const originalState = checkbox.checked;
            
            // Test enabled status
            checkbox.checked = true;
            checkbox.dispatchEvent(new Event('change'));
            
            setTimeout(() => {
                const enabledStatus = statusElement.textContent;
                
                // Test disabled status
                checkbox.checked = false;
                checkbox.dispatchEvent(new Event('change'));
                
                setTimeout(() => {
                    const disabledStatus = statusElement.textContent;
                    
                    if (enabledStatus !== disabledStatus) {
                        addTestResult('Checkbox', 'Status Indicator Update', true, 
                                    `Status changes: ${enabledStatus} ‚Üí ${disabledStatus}`);
                    } else {
                        addTestResult('Checkbox', 'Status Indicator Update', false, 'Status does not change');
                    }
                    
                    // Restore original state
                    checkbox.checked = originalState;
                    checkbox.dispatchEvent(new Event('change'));
                }, 100);
            }, 100);
        }
        
        function runAllTests() {
            console.log('üöÄ Running all tests...');
            clearResults();
            
            setTimeout(() => testDropdownTextCropping(), 100);
            setTimeout(() => testDropdownWidth(), 200);
            setTimeout(() => testDropdownResponsive(), 300);
            setTimeout(() => testCheckboxValidation(), 400);
            setTimeout(() => testAutoRotation(), 500);
            setTimeout(() => testPersistence(), 600);
            setTimeout(() => testStatusIndicator(), 700);
            
            setTimeout(() => {
                const passedTests = testResults.filter(t => t.passed).length;
                const totalTests = testResults.length;
                const successRate = Math.round((passedTests / totalTests) * 100);
                
                addTestResult('Combined', 'Overall Test Results', successRate >= 80, 
                            `${passedTests}/${totalTests} passed (${successRate}%)`);
            }, 1000);
        }
        
        function clearResults() {
            testResults = [];
            document.getElementById('dropdown-results').innerHTML = '';
            document.getElementById('checkbox-results').innerHTML = '';
            document.getElementById('combined-results').innerHTML = '';
            document.getElementById('validation-report').innerHTML = '<div>Results cleared</div>';
        }
        
        function exportResults() {
            const exportData = {
                timestamp: new Date().toISOString(),
                results: testResults,
                summary: {
                    total: testResults.length,
                    passed: testResults.filter(t => t.passed).length,
                    failed: testResults.filter(t => !t.passed).length,
                    successRate: Math.round((testResults.filter(t => t.passed).length / testResults.length) * 100)
                }
            };
            
            const blob = new Blob([JSON.stringify(exportData, null, 2)], 
                                { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `dropdown-checkbox-test-${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }
        
        function updateValidationReport(results) {
            const reportContainer = document.getElementById('validation-report');
            
            if (results && results.validationResults) {
                const html = `
                    <div><strong>Validation Report - ${new Date().toLocaleString()}</strong></div>
                    <div>Checkbox Exists: ${results.validationResults.checkboxExists ? '‚úÖ' : '‚ùå'}</div>
                    <div>Event Listeners: ${results.validationResults.eventListenersAttached ? '‚úÖ' : '‚ùå'}</div>
                    <div>Auto-Rotate Working: ${results.validationResults.autoRotateWorking ? '‚úÖ' : '‚ùå'}</div>
                    <div>Local Storage: ${results.validationResults.localStorageWorking ? '‚úÖ' : '‚ùå'}</div>
                    <div>Theme Switching: ${results.validationResults.themeSwitchingWorking ? '‚úÖ' : '‚ùå'}</div>
                    <div>Status Indicator: ${results.validationResults.statusIndicatorWorking ? '‚úÖ' : '‚ùå'}</div>
                    <div>&nbsp;</div>
                    <div><strong>Detailed Test Results:</strong></div>
                    ${results.testResults.map(test => 
                        `<div>${test.passed ? '‚úÖ' : '‚ùå'} ${test.test}: ${test.details || 'No details'}</div>`
                    ).join('')}
                `;
                
                reportContainer.innerHTML = html;
            }
        }
        
        function measureText(text, element) {
            // Create a temporary element to measure text
            const temp = document.createElement('div');
            temp.style.position = 'absolute';
            temp.style.visibility = 'hidden';
            temp.style.height = 'auto';
            temp.style.width = 'auto';
            temp.style.whiteSpace = 'nowrap';
            temp.style.font = window.getComputedStyle(element).font;
            temp.textContent = text;
            document.body.appendChild(temp);
            
            const width = temp.clientWidth;
            document.body.removeChild(temp);
            
            return width;
        }
        
        // Auto-run tests when page loads
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                console.log('üöÄ Auto-running dropdown and checkbox tests...');
                runAllTests();
            }, 1000);
        });
    </script>
</body>
</html>
