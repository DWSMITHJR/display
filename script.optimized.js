class StatusDisplay{constructor(){this.weatherData=null;this.autoRotateInterval=null;this.themes=['style.css','styles/dark.css','styles/ocean.css','styles/sunset.css','styles/forest.css','styles/cyberpunk.css','styles/galaxy.css','styles/aurora.css','styles/vintage.css','styles/minimal.css','styles/neon.css','styles/candy.css'];this.currentThemeIndex=0;this.init()}async init(){this.initStyleSelector();this.initFullscreen();this.startClock();await this.updateWeather();this.initWeatherRefresh();this.initResponsiveHandling();this.initKeyboardShortcuts();setInterval(()=>this.updateAll(),1000);setInterval(()=>this.updateWeather(),600000)}initWeatherRefresh(){const e=document.querySelector('.weather-display');e&&(e.style.cursor='pointer',e.title='Click to refresh weather',e.addEventListener('click',()=>{e.style.opacity='0.7';this.updateWeather().then(()=>{e.style.opacity='1'}).catch(t=>{e.style.opacity='1';console.error('Weather refresh failed:',t)})}))}initResponsiveHandling(){let t;const e=()=>{clearTimeout(t),t=setTimeout(()=>{this.adjustThemePanelPosition();this.applyResponsiveAdjustments()},250)};window.addEventListener('resize',e);window.addEventListener('orientationchange',()=>{setTimeout(()=>{this.adjustThemePanelPosition();this.applyResponsiveAdjustments()},100)});this.adjustThemePanelPosition();this.applyResponsiveAdjustments()}initKeyboardShortcuts(){document.addEventListener('keydown',e=>{if(e.target.tagName==='INPUT'||e.target.tagName==='TEXTAREA')return;switch(e.key.toLowerCase()){case't':e.preventDefault();this.cycleTheme();break;case'f':e.preventDefault();this.toggleFullscreen();break;case'r':e.preventDefault();this.updateWeather();break;case'1':case'2':case'3':case'4':case'5':case'6':case'7':case'8':case'9':e.preventDefault();this.selectThemeByNumber(parseInt(e.key)-1);break;case'0':e.preventDefault();this.selectThemeByNumber(9);break;case'-':e.preventDefault();this.selectThemeByNumber(10);break;case'=':e.preventDefault();this.selectThemeByNumber(11);break}})}selectThemeByNumber(e){if(e>=0&&e<this.themes.length){const t=document.getElementById('style-dropdown'),s=document.getElementById('main-style');t&&s&&(t.value=this.themes[e],this.applyStyle(this.themes[e],t,s),this.currentThemeIndex=e,this.showNotification(`Switched to ${this.getThemeName(this.themes[e])} theme`))}}cycleTheme(){const e=document.getElementById('style-dropdown'),t=document.getElementById('main-style');if(!e||!t)return;this.currentThemeIndex=(this.currentThemeIndex+1)%this.themes.length;const s=this.themes[this.currentThemeIndex];e.value=s;this.applyStyle(s,e,t);this.showNotification(`Switched to ${this.getThemeName(s)} theme`)}initStyleSelector(){const e=document.getElementById('style-dropdown'),t=document.getElementById('main-style'),s=document.getElementById('theme-panel'),n=document.getElementById('auto-rotate');if(!e||!t)return;this.initDraggablePanel(s);const o=localStorage.getItem('selectedStyle');if(o&&this.validateStylePath(o)){this.applyStyle(o,e,t);this.currentThemeIndex=this.themes.indexOf(o);console.log('Loaded saved theme:',o,'at index:',this.currentThemeIndex)}else{this.currentThemeIndex=0;console.log('Using default theme at index:',this.currentThemeIndex)}const i=localStorage.getItem('autoRotateThemes')==='true';n&&(n.checked=i,i&&this.startAutoRotate());e.addEventListener('change',r=>{this.applyStyle(r.target.value,e,t);this.currentThemeIndex=this.themes.indexOf(r.target.value);if(n&&n.checked){n.checked=false;localStorage.setItem('autoRotateThemes','false');this.stopAutoRotate();this.showNotification(`Switched to ${this.getThemeName(r.target.value)} theme (auto-rotation stopped)`);console.log('Auto-rotation stopped due to manual theme selection')}else{this.showNotification(`Switched to ${this.getThemeName(r.target.value)} theme`)}});n&&n.addEventListener('change',r=>{const a=r.checked;localStorage.setItem('autoRotateThemes',a);a?this.startAutoRotate():this.stopAutoRotate()})}initDraggablePanel(e){if(!e)return;console.log('Initializing draggable theme panel');e.title='Drag to move this panel anywhere on screen';let t=0,s=0,n=0,o=0;const i=r=>{r.preventDefault();n=r.clientX;o=r.clientY;const a=window.getComputedStyle(e);t=parseInt(a.left,10)-n;s=parseInt(a.top,10)-o;document.addEventListener('mousemove',l);document.addEventListener('mouseup',c)};const l=r=>{r.preventDefault();e.style.left=r.clientX+t+'px';e.style.top=r.clientY+s+'px';e.style.right='auto';e.style.bottom='auto'};const c=()=>{document.removeEventListener('mousemove',l);document.removeEventListener('mouseup',c)};e.addEventListener('mousedown',i);e.addEventListener('touchstart',r=>{const a=r.touches[0];n=a.clientX;o=a.clientY;const l=window.getComputedStyle(e);t=parseInt(l.left,10)-n;s=parseInt(l.top,10)-o;document.addEventListener('touchmove',d);document.addEventListener('touchend',h)});const d=r=>{r.preventDefault();const a=r.touches[0];e.style.left=a.clientX+t+'px';e.style.top=a.clientY+s+'px';e.style.right='auto';e.style.bottom='auto'};const h=()=>{document.removeEventListener('touchmove',d);document.removeEventListener('touchend',h)};this.adjustThemePanelPosition()}adjustThemePanelPosition(){const e=document.getElementById('theme-panel');if(!e)return;const t=window.innerWidth,s=window.innerHeight,n=e.offsetWidth,o=e.offsetHeight;let i=parseInt(window.getComputedStyle(e).right,10),l=parseInt(window.getComputedStyle(e).top,10);isNaN(i)&&(i=12);isNaN(l)&&(l=12);i+n>t-20&&(i=t-n-20);l+o>s-20&&(l=s-o-20);i<20&&(i=20);l<20&&(l=20);e.style.right=i+'px';e.style.top=l+'px';e.style.left='auto';e.style.bottom='auto'}applyResponsiveAdjustments(){const e=window.innerWidth,t=document.getElementById('theme-panel');if(!t)return;if(e<768){t.style.transform='scale(0.85)';t.style.transformOrigin='top right'}else if(e<1024){t.style.transform='scale(0.95)';t.style.transformOrigin='top right'}else{t.style.transform='scale(1)';t.style.transformOrigin='top right'}}validateStylePath(e){return this.themes.includes(e)}applyStyle(e,t,s){const n=document.getElementById('style-dropdown'),o=document.getElementById('main-style');if(!n||!o||!this.validateStylePath(e))return;const i=localStorage.getItem('selectedStyle');if(i!==e){localStorage.setItem('selectedStyle',e);console.log('Theme changed from',i,'to',e)}n.value=e;o.href=e;this.currentThemeIndex=this.themes.indexOf(e);console.log('Applied style:',e,'(index:',this.currentThemeIndex,')')}startClock(){this.updateTime();setInterval(()=>this.updateTime(),1000)}updateTime(){const e=new Date,t=e.toLocaleDateString('en-US',{weekday:'long'}),s=e.toLocaleDateString('en-US',{month:'long',day:'numeric',year:'numeric'}),n=e.toLocaleTimeString('en-US',{hour12:true,hour:'2-digit',minute:'2-digit',second:'2-digit'}),o=e.toLocaleTimeString('en-US',{hour12:true,hour:'2-digit',minute:'2-digit'}),i=e.getHours();let l='Morning';if(i>=12&&i<17)l='Afternoon';else if(i>=17&&i<21)l='Evening';else if(i>=21||i<5)l='Night';else if(i>=5&&i<12)l='Morning';const c=document.getElementById('day-name'),r=document.getElementById('time-display'),a=document.getElementById('date-display'),d=document.getElementById('time-period'),h=document.getElementById('timezone-display'),u=document.getElementById('city-display');c&&(c.textContent=t);r&&(r.textContent=n);a&&(a.textContent=s);d&&(d.textContent=l);h&&(h.textContent='Local Time');u&&(u.textContent='Current Location')}async updateWeather(){const e=document.getElementById('weather-icon'),t=document.getElementById('temperature'),s=document.getElementById('weather-description'),n=document.getElementById('location'),o=document.getElementById('feels-like'),i=document.getElementById('humidity'),l=document.getElementById('wind-speed'),c=document.getElementById('visibility'),r=document.getElementById('weather-update-time');try{const a=await this.getCurrentLocation();if(!a)throw new Error('Location access denied');const d=await this.fetchWeatherData(a);if(!d||!d.current)throw new Error('Weather data unavailable');this.weatherData=d;const h=d.current,u=d.location;e&&(e.textContent=this.getWeatherEmoji(h.condition));t&&(t.textContent=`${Math.round(h.temp_f)}Â°F`);s&&(s.textContent=h.condition.text);n&&(n.textContent=`${u.name}, ${u.region}`);o&&(o.textContent=`${Math.round(h.feelslike_f)}Â°F`);i&&(i.textContent=`${h.humidity}%`);l&&(l.textContent=`${h.wind_mph} mph`);c&&(c.textContent=`${h.vis_miles} mi`);r&&(r.textContent=`Updated ${new Date().toLocaleTimeString()}`);console.log('Weather updated successfully:',{location:u.name,condition:h.condition.text,temp:h.temp_f})}catch(p){console.error('Weather update failed:',p);this.showWeatherError(p.message)}}async getCurrentLocation(){return new Promise((e,t)=>{if(!navigator.geolocation){t(new Error('Geolocation not supported'));return}navigator.geolocation.getCurrentPosition(s=>{e({lat:s.coords.latitude,lon:s.coords.longitude})},s=>{console.warn('Geolocation failed, using default location');e({lat:33.749,lon:-84.388})},{timeout:10000,enableHighAccuracy:true})})}async fetchWeatherData(e){const t='https://api.weatherapi.com/v1/current.json',s='demo';try{const n=await fetch(`${t}?key=${s}&q=${e.lat},${e.lon}&aqi=no`);if(!n.ok)throw new Error(`HTTP ${n.status}`);return await n.json()}catch(n){console.error('Weather API failed:',n);return this.getFallbackWeatherData()}}getFallbackWeatherData(){return{location:{name:'Atlanta',region:'GA'},current:{temp_f:72,feelslike_f:70,condition:{text:'Partly Cloudy'},humidity:65,wind_mph:8,vis_miles:10}}}getWeatherEmoji(e){const t=e.toLowerCase();if(t.includes('sunny')||t.includes('clear'))return'â˜€ï¸';if(t.includes('cloud')||t.includes('overcast'))return'â˜ï¸';if(t.includes('rain')||t.includes('drizzle'))return'ðŸŒ§ï¸';if(t.includes('snow')||t.includes('sleet'))return'â„ï¸';if(t.includes('thunder')||t.includes('storm'))return'â›ˆï¸';if(t.includes('fog')||t.includes('mist'))return'ðŸŒ«ï¸';if(t.includes('wind'))return'ðŸ’¨';return'ðŸŒ¤ï¸'}showWeatherError(e){const t=document.getElementById('weather-icon'),s=document.getElementById('temperature'),n=document.getElementById('weather-description'),o=document.getElementById('location'),i=document.getElementById('feels-like'),l=document.getElementById('humidity'),c=document.getElementById('wind-speed'),r=document.getElementById('visibility'),a=document.getElementById('weather-update-time');t&&(t.textContent='â“');s&&(s.textContent='--Â°F');n&&(n.textContent='Weather unavailable');o&&(o.textContent='Location unknown');i&&(i.textContent='--Â°F');l&&(l.textContent='--%');c&&(c.textContent='-- mph');r&&(r.textContent='-- mi');a&&(a.textContent=`Error: ${e}`)}showNotification(e){const t=document.createElement('div');t.style.cssText='position:fixed;top:20px;left:50%;transform:translateX(-50%);background:rgba(0,0,0,0.8);color:white;padding:10px 20px;border-radius:5px;z-index:10000;font-size:14px;opacity:0;transition:opacity 0.3s ease;pointer-events:none';t.textContent=e;document.body.appendChild(t);setTimeout(()=>t.style.opacity='1',10);setTimeout(()=>{t.style.opacity='0';setTimeout(()=>document.body.removeChild(t),300)},2000)}initFullscreen(){const e=document.getElementById('fullscreen-toggle'),t=document.getElementById('fullscreen-icon');if(!e||!t)return;e.addEventListener('click',()=>{this.toggleFullscreen()});document.addEventListener('fullscreenchange',()=>{t.textContent=document.fullscreenElement?'â›¶':'â›¶'})}toggleFullscreen(){if(!document.fullscreenElement){document.documentElement.requestFullscreen().catch(e=>{console.error('Fullscreen failed:',e)})}else{document.exitFullscreen()}}updateAll(){this.updateTime()}startAutoRotate(){console.log('Starting theme auto-rotation');this.stopAutoRotate();const e=document.getElementById('style-dropdown');if(e){const t=e.value,s=this.themes.indexOf(t);s!==-1?this.currentThemeIndex=s:(console.log('Current theme not found in themes array, using index 0'),this.currentThemeIndex=0)}this.showNotification('Theme rotation started (30s intervals)');this.autoRotateInterval=setInterval(()=>{this.currentThemeIndex=(this.currentThemeIndex+1)%this.themes.length;const t=this.themes[this.currentThemeIndex],s=document.getElementById('style-dropdown'),n=document.getElementById('main-style'),o=document.getElementById('auto-rotate');if(o&&o.checked&&s&&n){this.applyStyle(t,s,n);console.log('Auto-rotated to theme:',t,'(index:',this.currentThemeIndex,')');if(window.location.search.includes('debug=true')||window.location.hostname==='localhost'){this.showNotification(`Theme: ${this.getThemeName(t)}`)}}else{console.log('Auto-rotation disabled or elements missing, stopping rotation');this.stopAutoRotate()}},30000);console.log('Auto-rotation started with 30-second intervals from index:',this.currentThemeIndex)}stopAutoRotate(){if(this.autoRotateInterval){console.log('Stopping theme auto-rotation');clearInterval(this.autoRotateInterval);this.autoRotateInterval=null;this.showNotification('Theme rotation stopped')}}startAutoRotateDebug(){console.log('Starting DEBUG theme auto-rotation (5-second intervals)');this.stopAutoRotate();const e=document.getElementById('style-dropdown');if(e){const t=e.value,s=this.themes.indexOf(t);s!==-1?this.currentThemeIndex=s:console.log('DEBUG: Synced currentThemeIndex to:',this.currentThemeIndex,'for theme:',t)}this.showNotification('DEBUG: Theme rotation started (5s intervals)');this.autoRotateInterval=setInterval(()=>{this.currentThemeIndex=(this.currentThemeIndex+1)%this.themes.length;const t=this.themes[this.currentThemeIndex],s=document.getElementById('style-dropdown'),n=document.getElementById('main-style'),o=document.getElementById('auto-rotate');if(o&&o.checked&&s&&n){this.applyStyle(t,s,n);console.log('DEBUG: Auto-rotated to theme:',t,'(index:',this.currentThemeIndex,')');this.showNotification(`DEBUG: ${this.getThemeName(t)}`)}else{console.log('DEBUG: Auto-rotation disabled or elements missing, stopping rotation');this.stopAutoRotate()}},5000);console.log('DEBUG: Auto-rotation started with 5-second intervals from index:',this.currentThemeIndex)}getThemeName(e){const t={'style.css':'Original','styles/dark.css':'Dark','styles/ocean.css':'Ocean','styles/sunset.css':'Sunset','styles/forest.css':'Forest','styles/cyberpunk.css':'Cyberpunk','styles/galaxy.css':'Galaxy','styles/aurora.css':'Aurora','styles/vintage.css':'Vintage','styles/minimal.css':'Minimal','styles/neon.css':'Neon','styles/candy.css':'Candy'};return t[e]|| e}}window.statusDisplay=new StatusDisplay;
